<div class="card-white p-4">
  <!-- Botão Cadastrar -->
  <button class="btn btn-primary mb-4" (click)="cadastrar()">
    <i class="fa-solid fa-circle-plus"></i> &nbsp;
    Incluir Usuário
  </button>

  <!-- Filtros -->
  <div class="d-flex justify-content-between gap-3 mb-4 p-0">
    <mat-form-field appearance="outline" class="w-100">
      <mat-label>Nome</mat-label>
      <input matInput placeholder="Filtrar por nome" (keyup)="debounceNomeUsuario.next(getInputValue($event))">
    </mat-form-field>

    <mat-form-field appearance="outline" class="w-100">
      <mat-label>E-mail</mat-label>
      <input matInput placeholder="Filtrar por e-mail" (keyup)="debounceEmailUsuario.next(getInputValue($event))">
    </mat-form-field>

    <mat-form-field appearance="outline" class="w-100">
      <mat-label>Acesso</mat-label>
      <mat-select (selectionChange)="alterarFiltroAcesso($event.value)" panelClass="acesso-select-panel">
        <mat-option [value]="2"></mat-option>
        <mat-option [value]="1">Admin</mat-option>
        <mat-option [value]="0">Usuário</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline" class="w-100">
      <mat-label>Desativado</mat-label>
      <mat-select (selectionChange)="alterarFiltroDesativado($event.value)" panelClass="acesso-select-panel">
        <mat-option [value]="0">Não</mat-option>
        <mat-option [value]="1">Sim</mat-option>
      </mat-select>
    </mat-form-field>
  </div>

  <!-- Errors -->
  <alert type="danger" [dismissible]="true" (onClosed)="limparErros()" class="text-center anima-alert"
    *ngIf="errors.length > 0">
    <span class="fw-bolder fs-6">Oops...alguma coisa não deu certo:</span> <br>
    <ul>
      <li class="fs-small mt-1">
        {{ errors }}
      </li>
    </ul>
  </alert>

  <!-- Tabela -->
  <div class="shadow-sm rounded p-2">
    <table class="table table-striped table-hover rounded overflow-hidden"
      *ngIf="usuariosCadastrados && usuariosCadastrados.length > 0; else semUsuarios">
      <thead class="sticky-top table-secondary">
        <tr>
          <th class="fw-bolder text-primary fs-5">Nome</th>
          <th class="fw-bolder text-primary fs-5">E-mail</th>
          <th class="fw-bolder text-primary fs-5 text-center">Acesso</th>
          <th class="fw-bolder text-primary fs-5 text-center">Status</th>
          <th class="fw-bolder text-primary fs-5 text-center">Ações</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let usuario of usuariosCadastrados">
          <td> {{ usuario.nome }}</td>
          <td>{{ usuario.email.conta }}</td>

          <td class="text-center">
            <span class="badge rounded-pill px-3 py-2"
              [ngClass]="usuario.administrador ? 'bg-primary' : 'bg-secondary'">
              {{ usuario.administrador ? 'Admin' : 'Usuário' }}
            </span>
          </td>

          <td class="text-center">
            <span class="badge rounded-pill px-3 py-2" [ngClass]="usuario.desativado ? 'bg-danger' : 'bg-success'">
              {{ usuario.desativado ? 'Desativado' : 'Ativo' }}
            </span>
          </td>


          <td class="text-center">
            <button class="btn btn-primary rounded-5" [matMenuTriggerFor]="menu">
              <i class="fa-solid fa-ellipsis"></i>
            </button>
            <mat-menu #menu="matMenu">
              <button mat-menu-item (click)="desativar(usuario)" *ngIf="!usuario.desativado">
                <i class="fa-solid fa-user-slash text-danger"></i> &nbsp;
                Desativar Usuário
              </button>

              <button mat-menu-item (click)="ativar(usuario)" *ngIf="usuario.desativado">
                <i class="fa-solid fa-user-check text-success"></i> &nbsp;
                Ativar Usuário
              </button>

              <button mat-menu-item (click)="editar(usuario.id)" *ngIf="!usuario.desativado">
                <i class="fa-solid fa-pen text-primary"></i> &nbsp;
                Editar Usuário
              </button>

              <button mat-menu-item (click)="enviarConfirmarEmail(usuario)" *ngIf="!usuario.desativado">
                <i class="fa-solid fa-envelope text-warning"></i> &nbsp;
                Enviar Confirmar E-mail
              </button>

              <button mat-menu-item (click)="enviarDefinirSenha(usuario)" *ngIf="!usuario.desativado">
                <i class="fa-solid fa-key text-info"></i> &nbsp;
                Enviar Definir Senha
              </button>
            </mat-menu>
          </td>
        </tr>
      </tbody>
    </table>

    <ng-template #semUsuarios>
      <div class="text-center mt-3">
        Nenhum usuário encontrado.
      </div>
    </ng-template>
  </div>

</div>