<section id="cupom-fiscal" class="content py-3 px-4 d-flex flex-column justify-content-between"
  style="max-height: 100%;">

  <!-- Input -->
  <div class="card rounded-4 shadow-sm mb-3">
    <div class="card-header rounded-top-4 bg-primary text-white">
      <h1 class="fs-5 fw-bolder text-white">Leitura de QR Code</h1>
    </div>
    <div class="card-body">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>
          <i class="fa-solid fa-qrcode me-2"></i>
          <span>Escaneie o QR Code</span>
        </mat-label>
        <input matInput placeholder="Aponte o leitor para o cupom fiscal.">
      </mat-form-field>
    </div>
  </div>

  <!-- Cards -->
  <div class="d-flex justify-content-between gap-3 mb-3">

    <div class="card w-100 shadow-sm py-2 px-3 shadow-sm rounded-3 bg-white border-start-warning">
      <div class="d-flex align-items-center my-auto">
        <i class="fa-solid fa-hourglass-half fs-3 text-white bg-warning p-2 rounded-3 me-3"></i>
        <div>
          <div class="fs-5 pt-1 fw-bold text-dark">{{ cuponsFiscaisResponse.processando }}</div>
          <div class="text-secondary ">Processando...</div>
        </div>
      </div>
    </div>

    <div class="card w-100 shadow-sm py-2 px-3 shadow-sm rounded-3 bg-white border-start-primary">
      <div class="d-flex align-items-center my-auto">
        <i class="fa-solid fa-file-invoice fs-3 text-white bg-primary p-2 rounded-3 me-3"></i>
        <div>
          <div class="fs-5 pt-1 fw-bold text-dark">{{ totalProcessadas }}</div>
          <div class="text-secondary ">Processadas</div>
        </div>
      </div>
    </div>

    <div class="card w-100 shadow-sm py-2 px-3 shadow-sm rounded-3 bg-white border-start-success">
      <div class="d-flex align-items-center my-auto">
        <i class="fa-solid fa-check fs-3 text-white bg-success p-2 rounded-3 me-3"></i>
        <div>
          <div class="fs-5 pt-1 fw-bold text-dark">{{ cuponsFiscaisResponse.sucesso }}</div>
          <div class="text-secondary ">Com Sucesso</div>
        </div>
      </div>
    </div>

    <div class="card w-100 shadow-sm py-2 px-3 shadow-sm rounded-3 bg-white border-start-danger">
      <div class="d-flex align-items-center my-auto">
        <i class="fa-solid fa-triangle-exclamation fs-3 text-white bg-danger p-2 rounded-3 me-3"></i>
        <div>
          <div class="fs-5 pt-1 fw-bold text-dark">{{ cuponsFiscaisResponse.erro }}</div>
          <div class="text-secondary ">Com Erro</div>
        </div>
      </div>
    </div>

    <div class="card w-100 shadow-sm py-2 px-3 shadow-sm rounded-3 bg-white border-start-info">
      <div class="d-flex align-items-center my-auto">
        <i class="fa-solid fa-percent fs-3 text-white bg-info p-2 rounded-3 me-3"></i>
        <div>
          <div class="fs-5 pt-1 fw-bold text-dark">{{ percentualSucesso }} %</div>
          <div class="text-secondary ">Taxa de Sucesso</div>
        </div>
      </div>
    </div>

  </div>


  <div class="card rounded-4 w-100 px-4 py-3 shadow-sm">

    <!-- Filtro -->
    <div class="d-flex gap-3 w-100 p-3 rounded">
      <mat-form-field appearance="outline" class="w-25">
        <mat-label>Competência:</mat-label>
        <input matInput [matDatepicker]="competencia" [(ngModel)]="data">
        <mat-datepicker-toggle matIconSuffix [for]="competencia"></mat-datepicker-toggle>
        <mat-datepicker #competencia></mat-datepicker>
      </mat-form-field>

      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Cadastrado Por:</mat-label>
        <mat-select>
          <mat-option *ngFor="let usuario of usuariosAtivos" [value]="usuario.id">
            <span class="bg-primary-light py-1 px-3 rounded-pill text-white fs-small">
              {{ usuario.nome | titlecase }} - {{ usuario.email.conta }}
            </span>
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="w-25">
        <mat-label>Status:</mat-label>
        <mat-select>
          <mat-option></mat-option>
          <mat-option *ngFor="let sts of status" [value]="sts.chave">
            <span class="py-1 px-3 rounded-pill" [ngClass]="{
              'bg-warning-pastel': sts.chave === 0, 
              'bg-success-pastel': sts.chave === 1,
              'bg-danger-pastel': sts.chave === 2
              }">
              {{ sts.valor | titlecase }}
            </span>
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <!-- Tabela -->
    <div class="table-responsive card w-100 overflow-auto">
      <table class="table table-striped table-hover rounded" style="max-height: 100%;">
        <thead class="sticky-top table-secondary">
          <tr class="text-center fs-5 fw-bolder">
            <th class="text-primary align-middle">Número</th>
            <th class="text-primary align-middle">CNPJ</th>
            <th class="text-primary align-middle">Competência</th>
            <th class="text-primary align-middle">Data do Cadastro</th>
            <th class="text-primary align-middle">Cadastrado Por</th>
            <th class="text-primary align-middle">Status</th>
            <th class="text-primary align-middle pe-4">Erro</th>
          </tr>
        </thead>
        <tbody class="text-center">
          <tr *ngFor="let cupom of cuponsFiscaisResponse.cuponsFiscais ">
            <td>{{ cupom.numero }}</td>
            <td>{{ cupom.cnpj }}</td>
            <td>{{ cupom.competencia | date:'MM/yyyy' }}</td>
            <td>{{ cupom.cadastradoEm | date:'dd/MM/yyyy' }}</td>
            <td>
              <span class="bg-primary-light py-1 px-3 rounded-pill text-white">
                {{ cupom.cadastradoPor.nome | titlecase}}
              </span>
            </td>
            <td>
              <span class="py-1 px-3 rounded-pill" [ngClass]="{
                    'bg-warning-pastel': cupom.status === 0,
                    'bg-success-pastel': cupom.status === 1,
                    'bg-danger-pastel': cupom.status === 2
                    }">
                {{ cupom.statusNome | titlecase }}
              </span>
            </td>
            <td>
              <button class="btn btn-primary rounded-2 fs-small" *ngIf="cupom.status === 2">
                <i class="fa-solid fa-search text-white"></i>
              </button>
              <!--Apenas mantem o tamanho da linha -->
              <button class="btn rounded-2 fs-small border-0" disabled *ngIf="cupom.status != 2"><i
                  class="fa-solid"></i></button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>


    <!-- NÃO MEXER MAIS -->
    <div class="d-flex justify-content-between align-items-center mt-2 gap-5 w-100">

      <div class="d-flex align-items-center gap-2">
        <span>Cupons por página:</span>
        <mat-form-field appearance="outline" class="w-25" subscriptSizing="dynamic" floatLabel="always">
          <mat-select [(ngModel)]="filtroRegistroPorPagina" (selectionChange)="onPageChange(1)" >
            <mat-option [value]="1">1</mat-option>
            <mat-option [value]="3">3</mat-option>
            <mat-option [value]="5">5</mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <div>
        <ngb-pagination [collectionSize]="cuponsFiscaisResponse.total" [(page)]="pagina"
          [pageSize]="filtroRegistroPorPagina" (pageChange)="onPageChange($event)" [maxSize]="5" [rotate]="true"
          [ellipses]="false" [boundaryLinks]="true">
        </ngb-pagination>
      </div>

      <div>
        Página {{ cuponsFiscaisResponse.pagina }} de {{ totalPaginas }}
      </div>
    </div>

  </div>


</section>